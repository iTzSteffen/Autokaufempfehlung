function loadConfig(e){var t=DOMAIN||weloop_getdomain();if(t){var o=new XMLHttpRequest;o.open("GET",t+"/client/config.json",!0),o.onload=function(){var t=o.status;if(200===t){var n=JSON.parse(o.responseText);_hostApp_comete=n.Data.app_url,_hostApi_comete=n.Data.api_url,e()}else e(t,o.response)},o.send()}}function comete_trigger(){if(isFirefox){(e=document.createEvent("Event")).initEvent("comete_trigger",!0,!0),document.dispatchEvent(e)}else if(isChrome){(e=document.createEvent("Event")).initEvent("comete_trigger"),document.dispatchEvent(e)}else if(isSafari){var e=document.createEvent("Event");e.initEvent("comete_trigger"),document.dispatchEvent(e)}}function detectExtension(){return null!==document.getElementById("weloop-safariextensioncheck")}function loopArray(e,t,o,n,i){if(++limited_number_iframe>20)i();else if(e[iframe_index].classList.contains("weloop-frame")||e[iframe_index].classList.contains("weloop-tools"))++iframe_index<e.length?loopArray(e,t,o,n,i):i();else if("0px"==e[iframe_index].style.width||"0px"==e[iframe_index].style.height||"none"==e[iframe_index].style.display||"hidden"==e[iframe_index].style.visibility)++iframe_index<e.length?loopArray(e,t,o,n,i):i();else{if(testSameOrigin(e[iframe_index].src)){var r=e[iframe_index].contentWindow.document.getElementsByTagName("iframe");if(r.length>0){previous_iframe_index=iframe_index;var a=e[iframe_index].contentWindow.document.body,s=(f=e[iframe_index].getBoundingClientRect()).width,l=f.height,c=f.top,m=f.left,d=e[iframe_index].contentWindow.document.body.scrollTop||e[iframe_index].contentWindow.document.documentElement.scrollTop,u=e[iframe_index].contentWindow.document.body.scrollLeft||e[iframe_index].contentWindow.document.documentElement.scrollLeft,p=document.body.scrollTop||document.documentElement.scrollTop,g=document.body.scrollLeft||document.documentElement.scrollLeft;iframe_index=0,loopArray(r,c,m,2,function(){screenshotIframe(e[iframe_index],t,o,a,s,l,d,u,c,m,p,g,n,function(){iframe_index=previous_iframe_index+1,previous_iframe_index=0,iframe_index<e.length?loopArray(e,t,o,1,i):i()})})}else{var a=e[iframe_index].contentWindow.document.body,f=e[iframe_index].getBoundingClientRect(),s=f.width,l=f.height,c=f.top,m=f.left,d=e[iframe_index].contentWindow.document.body.scrollTop||e[iframe_index].contentWindow.document.documentElement.scrollTop,u=e[iframe_index].contentWindow.document.body.scrollLeft||e[iframe_index].contentWindow.document.documentElement.scrollLeft,p=document.body.scrollTop||document.documentElement.scrollTop,g=document.body.scrollLeft||document.documentElement.scrollLeft;screenshotIframe(e[iframe_index],t,o,a,s,l,d,u,c,m,p,g,n,function(){++iframe_index<e.length?loopArray(e,t,o,n,i):i()})}}else++iframe_index<e.length?loopArray(e,t,o,n,i):i()}}function screenshotIframe(e,t,o,n,i,r,a,s,l,c,m,d,u,p){COMETE_ZINDEX-=10,html2canvas(n,{onrendered:function(e){var n=document.createElement("canvas");n.setAttribute("width",i),n.setAttribute("height",r),n.setAttribute("crossOrigin","anonymous");var a=n.getContext("2d");try{a.drawImage(e,0,0)}catch(e){}var s=n.toDataURL(),g=document.createElement("img");g.src=s,1==u?(g.style.position="absolute",g.style.top=l+t+"px",g.style.left=c+o+"px"):(g.style.position="absolute",g.style.top=l+t+m+"px",g.style.left=c+o+d+"px"),g.style.zIndex=COMETE_ZINDEX,g.className="cometeiframecover",document.body.appendChild(g),p()}})}function testSameOrigin(e){var t=window.location,o=document.createElement("a");return o.href=e,o.hostname==t.hostname&&o.port==t.port&&o.protocol==t.protocol}function removeElementsByClass(e){for(var t=document.getElementsByClassName(e);t.length>0;)t[0].parentNode.removeChild(t[0])}function Comete(){this.init=function(){if(document.getElementById("weloop-tools"))return!1;this.loadFiles(),this.initCometeListener(),this.createTools()},this.loadFiles=function(){var e=document.head,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=_hostApp_comete+"/client/snippet/comete.css",e.appendChild(t);var o=document.createElement("script");o.src=_hostApp_comete+"/client/snippet/html2canvas.min.js",document.getElementsByTagName("head")[0].appendChild(o)},this.createTools=function(){if(document.getElementById("weloop-tools"))return!1;var e={setting_PrimaryColor:_currentPlugin.Setting_PrimaryColor,setting_SecondaryColor:_currentPlugin.Setting_SecondaryColor,setting_IconUrl:_currentPlugin.Setting_IconUrl,setting_Position:_currentPlugin.Setting_Position,setting_Message:window.btoa(unescape(encodeURIComponent(_currentPlugin.Setting_Message))),setting_lang:_currentPlugin.Language,setting_IsBlur:_currentPlugin.IsBlur},t=_hostApp_comete+"/client/ball/index.html?params="+btoa(JSON.stringify(e));_group_weloop&&(t+="&group="+btoa(JSON.stringify(_group_weloop))),t+="#"+PROJETID;var o=document.createElement("iframe");o.id="weloop-tools",o.className="weloop-tools weloop-min";var n=document.createAttribute("data-html2canvas-ignore");n.value="true",o.setAttributeNode(n),document.getElementsByTagName("body")[0].appendChild(o),o.src=t,o.onload=function(){"left"==e.setting_Position&&(document.getElementById("weloop-tools").style.left="20px");document.getElementById("weloop-tools").contentWindow.postMessage({name:"comete-createCometeFrame"},"*")},t=_hostApp_comete+"/app/plugin/index/#/load",t+="?params="+btoa(JSON.stringify(e)),CURRENTUSER&&(t+="&auto="+window.btoa(JSON.stringify(CURRENTUSER))),document.body.insertAdjacentHTML("beforeEnd",'<iframe src="'+t+'" id="weloop-frame" class="weloop-frame" data-html2canvas-ignore="true" style="display:none"></iframe>')},this.initCometeListener=function(){window.addEventListener("message",function(e){var t;if("tool-isNotif"===e.data.name&&(e.data.value?document.getElementById("weloop-tools").classList.add("weloop-notif"):document.getElementById("weloop-tools").classList.remove("weloop-notif")),"tool-initial"===e.data.name&&(t={name:"comete-reload",params:{url:window.location.href}},document.getElementById("weloop-tools").contentWindow.postMessage(t,"*")),"tool-close"!==e.data.name)if("tool-add"!==e.data.name)if("tool-conv"!==e.data.name){if("tool-mouseenter"===e.data.name&&document.getElementById("weloop-tools").classList.remove("weloop-min"),"tool-mouseleave"===e.data.name&&document.getElementById("weloop-tools").classList.add("weloop-min"),"cometeApp-close"===e.data.name)return hidePlugin(),t={name:"comete-reload",params:{url:window.location.href}},void document.getElementById("weloop-tools").contentWindow.postMessage(t,"*");if("cometeApp-capture"===e.data.name)return detectExtension()&&hidePlugin(),void setTimeout(function(){takeScreenshot()},200);if("cometeApp-clientLogs"===e.data.name)return t={name:"comete-clientLogs",clientLogs:traceLog},void document.getElementById("weloop-frame").contentWindow.postMessage(t,"*");if("cometeApp-cometeApp-getLanguage"===e.data.name)return t={name:"comete-getLanguage",langage:_currentPlugin.Language},void document.getElementById("weloop-frame").contentWindow.postMessage(t,"*");if("cometeApp-group"===e.data.name)return t={name:"comete-group",params:{group:_group_weloop}},void document.getElementById("weloop-frame").contentWindow.postMessage(t,"*");"cometeApp-extensionInstall"===e.data.name&&(t={name:"comete-extensionInstall",params:{value:detectExtension(),isIframe:window.location!==window.parent.location}},null!==document.getElementById("weloop-frame")&&document.getElementById("weloop-frame").contentWindow.postMessage(t,"*")),"cometeApp-getUrl"===e.data.name&&(t={name:"comete-getUrl",params:{url:window.location.href}},document.getElementById("weloop-frame").contentWindow.postMessage(t,"*"))}else showPlugin({name:e.data.value});else showPlugin({name:"create/0"});else document.getElementsByClassName("weloop-tools")[0].style.display="none"},!1)}}var DOMAIN,_currentPlugin,_group_weloop,_group_weloop2,WeLoopJS={weloop_init:function(e){DOMAIN=e.domain,loadConfig(function(t){if(document.getElementById("weloop-tools"))return!1;if(PROJETID=e.projectGuid,e.auto_authentication){if(AUTO_AUTHENTICATION=!0,!e.user)return!1;if(!(e.user.firstName&&e.user.lastName&&e.user.email))return!1;e.user.id="null",CURRENTUSER=e.user}e.user&&e.user.group?(_group_weloop=btoa(JSON.stringify(e.user.group)),_group_weloop2=e.user.group):(_group_weloop=btoa(JSON.stringify("")),_group_weloop2=""),_currentProject=e,checkProjectIsVisible();var o={projectguid:PROJETID,firstname:e.user?e.user.firstName:"",lastname:e.user?e.user.lastName:"",email:e.user?e.user.email:""};WeLoopJS.analytics_init(o)})},analytics_init:function(e){if(document.getElementById("weloop-analytics"))return!1;var t=_hostApp_comete+"/client/analytics/index.html?params="+btoa(JSON.stringify(e));document.body.insertAdjacentHTML("beforeEnd",'<iframe src="'+t+'" id="weloop-analytics" class="weloop-analytics" style="display:none">')}},_hostApp_comete="",_hostApi_comete="",weloop_getdomain=function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;++t)if(e[t].getAttribute("src")&&-1!=e[t].getAttribute("src").indexOf("/client/snippet/weloop.js"))return e[t].src.split("/client/")[0];return""},PROJETID="",CURRENTUSER=null,AUTO_AUTHENTICATION=!1,COMETE_CHROMEEXTENSION_ID="pbcjocejanlcjhpflogjcpbgekdnhjap",SUBPROJECTNAME="",PLATFORM="",_setting_text=null,_menuName="Public",EXTENSION_EXIST=!1,traceLog=[],iframe_index=0,previous_iframe_index=0,limited_number_iframe=0,previous_scroll_top=0,previous_scroll_left=0,COMETE_ZINDEX=9999,isOpera=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox="undefined"!=typeof InstallTrigger,isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isIE=!!document.documentMode,isEdge=!isIE&&!!window.StyleMedia,isChrome=!!window.chrome,isBlink=(isChrome||isOpera)&&!!window.CSS;document.addEventListener("DOMContentLoaded",function(){EXTENSION_EXIST=detectExtension()});var takeScreenshotUsingHtml2canvas=function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,document.getElementsByTagName("iframe");iframe_index=0,html2canvas(document.body,{onrendered:function(e){var t=document.createElement("canvas");t.setAttribute("width",window.innerWidth-12),t.setAttribute("height",window.innerHeight),t.setAttribute("crossOrigin","anonymous");var o=t.getContext("2d");try{o.drawImage(e,0,0,window.innerWidth-18,window.innerHeight,0,0,window.innerWidth-12,window.innerHeight)}catch(e){}var n=t.toDataURL();removeElementsByClass("cometeiframecover"),showPlugin();var i={name:"comete-captureUrl",params:{captureUrl:n}};document.getElementById("weloop-frame").contentWindow.postMessage(i,"*"),console.log(n)},width:window.innerWidth,height:window.innerHeight+e})},takeScreenshot=function(){detectExtension()?comete_trigger():takeScreenshotUsingHtml2canvas()},checkProjectIsVisible=function(){var e=new XMLHttpRequest,t=_hostApi_comete+"/api/UnauthorizedData/checkProjectIsVisible";e.onload=function(){var e=JSON.parse(this.responseText);e.access&&(_currentPlugin=e.project,(new Comete).init())},e.open("POST",t,!0),e.setRequestHeader("Content-Type","application/json; charset=UTF-8");var o={ProjectGuid:PROJETID,AutoAuthentication:AUTO_AUTHENTICATION,CurrentSubProjectName:SUBPROJECTNAME};null!=CURRENTUSER&&(o.Email=CURRENTUSER.email),e.send(JSON.stringify(o))},showPlugin=function(e){var t=document.getElementById("weloop-frame");if(e){var o={setting_PrimaryColor:_currentPlugin.Setting_PrimaryColor,setting_SecondaryColor:_currentPlugin.Setting_SecondaryColor,setting_IconUrl:_currentPlugin.Setting_IconUrl,setting_Position:_currentPlugin.Setting_Position,setting_Message:window.btoa(unescape(encodeURIComponent(_currentPlugin.Setting_Message))),setting_lang:_currentPlugin.Language,setting_IsBlur:_currentPlugin.IsBlur};src=_hostApp_comete+"/app/plugin/index/#/"+PROJETID+"/project/"+e.name,src+="?params="+btoa(JSON.stringify(o)),CURRENTUSER&&(src+="&auto="+window.btoa(JSON.stringify(CURRENTUSER))),_group_weloop&&(src+="&group="+btoa(JSON.stringify(_group_weloop))),_currentPlugin.CurrentSubProjectGuid&&(src+="&subproject="+_currentPlugin.CurrentSubProjectGuid),_setting_text&&(src+="&settingstext="+_setting_text),PLATFORM&&(src+="&platform="+PLATFORM),t?(t.src=src,t.style.display="block"):document.body.insertAdjacentHTML("beforeEnd",'<iframe src="'+src+'" id="weloop-frame" data-html2canvas-ignore="true"></iframe>')}else t.style.display="block"},hidePlugin=function(){document.getElementById("weloop-frame").style.display="none"},weloop_init_qlikview=function(e){PROJETID=e,checkProjectIsVisible()},weloop_init=function(e){loadConfig(function(t){if(document.getElementById("weloop-tools"))return!1;if(PROJETID=e.projectGuid,DOMAIN=e.domain,SUBPROJECTNAME=e.subproject,PLATFORM=e.platform,e.auto_authentication){if(AUTO_AUTHENTICATION=!0,!e.user)return!1;if(!(e.user.firstName&&e.user.lastName&&e.user.email))return!1;e.user.id="null",CURRENTUSER=e.user}e.user&&e.user.group?(_group_weloop=btoa(JSON.stringify(e.user.group)),_group_weloop2=e.user.group):(_group_weloop=btoa(JSON.stringify("")),_group_weloop2=""),e.setting_text&&(_setting_text=e.setting_text,console.log(_setting_text)),_currentProject=e,checkProjectIsVisible();var o={projectguid:PROJETID,firstname:e.user?e.user.firstName:"",lastname:e.user?e.user.lastName:"",email:e.user?e.user.email:""};WeLoopJS.analytics_init(o)})};